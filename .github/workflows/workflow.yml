name: GitHub Actions Demo

on: push

jobs:
  job1:
    runs-on: ubuntu-latest
    env:
      input: |
        {
          "TEST": "$(echo test)",
          "HAHA": "$(echo haha)"
        }
    outputs:
      output: ${{ steps.step.outputs.output }}
    steps:
      - id: step
        run: |
          OUTPUT_JSON="{}"
          echo '${{ env.input }}' | jq -r 'to_entries[] | "\(.key) \(.value)"' |
          while read -r key value; do
            val=$(eval "echo \"$value\"")
            OUTPUT_JSON=`echo $OUTPUT_JSON | jq --arg key "$key" --arg val "$val" '. + {($key): $val}'`
            OUTPUT=`echo $OUTPUT_JSON | jq -r '.'`
            echo "output=$OUTPUT" >> $GITHUB_OUTPUT
          done

  job2:
    runs-on: ubuntu-latest
    needs: job1
    steps:
      - run: echo "${{ needs.job1.outputs.output }}"
    
